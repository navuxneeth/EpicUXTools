<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BASE64 CONVERTER</title>
    <link rel="stylesheet" href="../shared-styles.css">
    <script src="../theme.js"></script>
    <style>
        .tab-buttons {
            display: flex;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
        }
        .tab-btn {
            flex: 1;
            padding: var(--space-md);
            border: 2px dashed var(--color-border);
            background: var(--color-input-bg);
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            cursor: pointer;
        }
        .tab-btn.active {
            background: var(--color-primary);
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        textarea {
            width: 100%;
            min-height: 200px;
            padding: var(--space-sm);
            border: 2px dashed var(--color-border);
            background: white;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
        }
        .upload-area {
            border: 3px dashed var(--color-border);
            padding: var(--space-xl);
            text-align: center;
            background: var(--color-input-bg);
            cursor: pointer;
            transition: all 0.3s;
            margin: var(--space-md) 0;
        }
        .upload-area:hover {
            background: var(--color-bg-alt);
        }
        .upload-area.dragover {
            background: var(--color-primary);
            color: white;
        }
        input[type="file"] {
            display: none;
        }
        .button-row {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
            margin: var(--space-md) 0;
        }
        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border: 3px dashed var(--color-border);
            margin: var(--space-md) 0;
            background: repeating-conic-gradient(#ccc 0% 25%, white 0% 50%) 50% / 20px 20px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-md);
        }
        .stat-box {
            border: 2px dashed var(--color-border);
            padding: var(--space-md);
            text-align: center;
            background: var(--color-input-bg);
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--color-primary);
        }
        .stat-label {
            font-size: 0.9rem;
            color: var(--color-text-dim);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="pixel-text">[BASE64 CONVERTER]</h1>
            <p class="subtitle">ENCODE/DECODE TEXT AND FILES TO BASE64</p>
        </header>

        <main class="main-content">
            <section class="pixel-panel">
                <div class="panel-header">
                    <span class="panel-title">◢ CONVERSION MODE ◣</span>
                </div>
                <div class="panel-content">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="switchTab('text-encode')">TEXT ENCODE</button>
                        <button class="tab-btn" onclick="switchTab('text-decode')">TEXT DECODE</button>
                        <button class="tab-btn" onclick="switchTab('file-encode')">FILE ENCODE</button>
                        <button class="tab-btn" onclick="switchTab('image-decode')">IMAGE DECODE</button>
                    </div>
                </div>
            </section>

            <!-- Text Encode Tab -->
            <div id="text-encode" class="tab-content active">
                <section class="pixel-panel">
                    <div class="panel-header">
                        <span class="panel-title">◢ INPUT TEXT ◣</span>
                    </div>
                    <div class="panel-content">
                        <textarea id="textInput" placeholder="Enter text to encode...">Hello, World!</textarea>
                        <div class="button-row">
                            <button class="pixel-button" onclick="encodeText()">ENCODE TO BASE64</button>
                            <button class="pixel-button-secondary" onclick="clearText('textInput')">CLEAR</button>
                        </div>
                    </div>
                </section>

                <section class="pixel-panel">
                    <div class="panel-header">
                        <span class="panel-title">◢ ENCODED OUTPUT ◣</span>
                    </div>
                    <div class="panel-content">
                        <textarea id="textOutput" readonly placeholder="Encoded base64 will appear here..."></textarea>
                        <div class="button-row">
                            <button class="pixel-button" onclick="copyToClipboard('textOutput')">COPY TO CLIPBOARD</button>
                        </div>
                        <div class="stats" id="encodeStats"></div>
                    </div>
                </section>
            </div>

            <!-- Text Decode Tab -->
            <div id="text-decode" class="tab-content">
                <section class="pixel-panel">
                    <div class="panel-header">
                        <span class="panel-title">◢ BASE64 INPUT ◣</span>
                    </div>
                    <div class="panel-content">
                        <textarea id="base64Input" placeholder="Enter base64 to decode..."></textarea>
                        <div class="button-row">
                            <button class="pixel-button" onclick="decodeText()">DECODE FROM BASE64</button>
                            <button class="pixel-button-secondary" onclick="clearText('base64Input')">CLEAR</button>
                        </div>
                    </div>
                </section>

                <section class="pixel-panel">
                    <div class="panel-header">
                        <span class="panel-title">◢ DECODED OUTPUT ◣</span>
                    </div>
                    <div class="panel-content">
                        <textarea id="decodedOutput" readonly placeholder="Decoded text will appear here..."></textarea>
                        <div class="button-row">
                            <button class="pixel-button" onclick="copyToClipboard('decodedOutput')">COPY TO CLIPBOARD</button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- File Encode Tab -->
            <div id="file-encode" class="tab-content">
                <section class="pixel-panel">
                    <div class="panel-header">
                        <span class="panel-title">◢ SELECT FILE ◣</span>
                    </div>
                    <div class="panel-content">
                        <div class="upload-area" id="fileUploadArea">
                            <div style="font-size: 3rem; margin-bottom: var(--space-md);">[FILE]</div>
                            <p style="font-size: 1.2rem; font-weight: bold;">CLICK OR DRAG FILE HERE</p>
                            <p style="font-size: 0.9rem; color: var(--color-text-dim);">Any file type supported</p>
                        </div>
                        <input type="file" id="fileInput">
                        <div id="fileInfo" style="display: none; margin-top: var(--space-md); padding: var(--space-md); border: 2px dashed var(--color-border); background: var(--color-input-bg);"></div>
                    </div>
                </section>

                <section class="pixel-panel" id="fileOutputSection" style="display: none;">
                    <div class="panel-header">
                        <span class="panel-title">◢ BASE64 OUTPUT ◣</span>
                    </div>
                    <div class="panel-content">
                        <textarea id="fileOutput" readonly placeholder="Base64 encoded file will appear here..."></textarea>
                        <div class="button-row">
                            <button class="pixel-button" onclick="copyToClipboard('fileOutput')">COPY TO CLIPBOARD</button>
                            <button class="pixel-button-secondary" onclick="downloadBase64()">DOWNLOAD AS .TXT</button>
                        </div>
                        <div class="stats" id="fileStats"></div>
                    </div>
                </section>
            </div>

            <!-- Image Decode Tab -->
            <div id="image-decode" class="tab-content">
                <section class="pixel-panel">
                    <div class="panel-header">
                        <span class="panel-title">◢ BASE64 IMAGE DATA ◣</span>
                    </div>
                    <div class="panel-content">
                        <textarea id="imageBase64Input" placeholder="Paste base64 encoded image data (with or without data:image prefix)..."></textarea>
                        <div class="button-row">
                            <button class="pixel-button" onclick="decodeImage()">DECODE & PREVIEW</button>
                            <button class="pixel-button-secondary" onclick="clearText('imageBase64Input')">CLEAR</button>
                        </div>
                    </div>
                </section>

                <section class="pixel-panel" id="imagePreviewSection" style="display: none;">
                    <div class="panel-header">
                        <span class="panel-title">◢ IMAGE PREVIEW ◣</span>
                    </div>
                    <div class="panel-content" style="text-align: center;">
                        <img id="imagePreview" class="image-preview" alt="Decoded image">
                        <div class="button-row">
                            <button class="pixel-button" onclick="downloadImage()">DOWNLOAD IMAGE</button>
                        </div>
                    </div>
                </section>
            </div>
        </main>

                <footer class="footer pixel-text">
            <p>BASE64 CONVERTER v1.0</p>
            <p class="footer-note">Encode and decode text and files to/from base64</p>
            <div class="footer-links">
                <span>Made by <a href="https://www.linkedin.com/in/navaneeth-sankar-k-p" target="_blank" rel="noopener noreferrer">Navaneeth Sankar K P</a></span>
                <span>|</span>
                <span><a href="https://github.com/navuxneeth/EpicUXTools" target="_blank" rel="noopener noreferrer">Github Repo</a></span>
            </div>
            <p class="footer-copyright">Copyright © 2025</p>
        </footer>
    </div>

    <script>
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
        }

        function encodeText() {
            const input = document.getElementById('textInput').value;
            const encoded = btoa(encodeURIComponent(input).replace(/%([0-9A-F]{2})/g, (match, p1) => String.fromCharCode('0x' + p1)));
            document.getElementById('textOutput').value = encoded;
            
            document.getElementById('encodeStats').innerHTML = `
                <div class="stat-box">
                    <div class="stat-value">${input.length}</div>
                    <div class="stat-label">INPUT CHARS</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">${encoded.length}</div>
                    <div class="stat-label">OUTPUT CHARS</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">${((encoded.length / input.length) * 100).toFixed(1)}%</div>
                    <div class="stat-label">SIZE INCREASE</div>
                </div>
            `;
        }

        function decodeText() {
            try {
                const input = document.getElementById('base64Input').value.trim();
                const decoded = decodeURIComponent(Array.prototype.map.call(atob(input), c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
                document.getElementById('decodedOutput').value = decoded;
            } catch (e) {
                alert('Invalid base64 input');
            }
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            navigator.clipboard.writeText(element.value).then(() => {
                alert('Copied to clipboard!');
            });
        }

        function clearText(elementId) {
            document.getElementById(elementId).value = '';
        }

        // File upload handling
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileInput = document.getElementById('fileInput');

        fileUploadArea.addEventListener('click', () => fileInput.click());
        
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('dragover');
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length) {
                handleFileUpload(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFileUpload(e.target.files[0]);
            }
        });

        function handleFileUpload(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const base64 = e.target.result;
                document.getElementById('fileOutput').value = base64;
                document.getElementById('fileOutputSection').style.display = 'block';
                
                document.getElementById('fileInfo').style.display = 'block';
                document.getElementById('fileInfo').innerHTML = `
                    <strong>File:</strong> ${file.name}<br>
                    <strong>Type:</strong> ${file.type || 'Unknown'}<br>
                    <strong>Size:</strong> ${(file.size / 1024).toFixed(2)} KB
                `;

                document.getElementById('fileStats').innerHTML = `
                    <div class="stat-box">
                        <div class="stat-value">${(file.size / 1024).toFixed(2)} KB</div>
                        <div class="stat-label">ORIGINAL SIZE</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">${(base64.length / 1024).toFixed(2)} KB</div>
                        <div class="stat-label">BASE64 SIZE</div>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function downloadBase64() {
            const base64 = document.getElementById('fileOutput').value;
            const blob = new Blob([base64], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'base64-encoded.txt';
            link.click();
        }

        function decodeImage() {
            try {
                let input = document.getElementById('imageBase64Input').value.trim();
                
                // If it doesn't start with data:, assume it's raw base64 and add a default prefix
                if (!input.startsWith('data:')) {
                    input = 'data:image/png;base64,' + input;
                }
                
                const img = document.getElementById('imagePreview');
                img.src = input;
                img.onload = () => {
                    document.getElementById('imagePreviewSection').style.display = 'block';
                };
                img.onerror = () => {
                    alert('Invalid image data');
                };
            } catch (e) {
                alert('Error decoding image: ' + e.message);
            }
        }

        function downloadImage() {
            const img = document.getElementById('imagePreview');
            const link = document.createElement('a');
            link.href = img.src;
            link.download = 'decoded-image.png';
            link.click();
        }
    </script>
</body>
</html>
